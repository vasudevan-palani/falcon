"use strict";const n=require("electron"),d=require("node:os"),t=require("node:path");process.env.DIST_ELECTRON=t.join(__dirname,"..");process.env.DIST=t.join(process.env.DIST_ELECTRON,"../dist");process.env.VITE_PUBLIC=process.env.VITE_DEV_SERVER_URL?t.join(process.env.DIST_ELECTRON,"../public"):process.env.DIST;d.release().startsWith("6.1")&&n.app.disableHardwareAcceleration();process.platform==="win32"&&n.app.setAppUserModelId(n.app.getName());n.app.requestSingleInstanceLock()||(n.app.quit(),process.exit(0));let e=null;const a=t.join(__dirname,"../preload/index.js"),p=process.env.VITE_DEV_SERVER_URL,r=t.join(process.env.DIST,"index.html");async function c(){e=new n.BrowserWindow({title:"Main window",titleBarStyle:"hidden",width:1920,height:1080,icon:t.join(process.env.VITE_PUBLIC,"dist/falconicon_512.icns"),webPreferences:{preload:a,nodeIntegration:!0,contextIsolation:!1,devTools:!0}}),e.setMinimumSize(1280,720),e.on("closed",()=>{e=null}),process.env.VITE_DEV_SERVER_URL?(e.loadURL(p),e.webContents.openDevTools()):e.loadFile(r),e.webContents.on("did-finish-load",()=>{e==null||e.webContents.send("main-process-message",new Date().toLocaleString())}),e.webContents.setWindowOpenHandler(({url:i})=>(i.startsWith("https:")&&n.shell.openExternal(i),{action:"deny"}))}n.app.whenReady().then(()=>{c();let i=e.getPosition();console.log(i),n.ipcMain.on("open-file-dialog",function(s){n.dialog.showOpenDialog(e,{properties:["openDirectory"]}).then(o=>{let l=o.filePaths;console.log(o),s.sender.send("selected-folder",l)})}),n.ipcMain.on("open-import-dialog",function(s){n.dialog.showOpenDialog(e,{properties:["openFile"]}).then(o=>{let l=o.filePaths;console.log(o),s.sender.send("selected-import-file",l[0])})}),n.ipcMain.on("dblclick-navbar",()=>{e.isMaximized()?e.unmaximize():e.maximize()}),n.ipcMain.on("closeApp",(s,o,l)=>{e.close()}),n.ipcMain.on("minimizeApp",(s,o,l)=>{e.minimize()})});n.app.on("window-all-closed",()=>{e=null,process.platform!=="darwin"&&n.app.quit()});n.app.on("second-instance",()=>{e&&(e.isMinimized()&&e.restore(),e.focus())});n.app.on("activate",()=>{const i=n.BrowserWindow.getAllWindows();i.length?i[0].focus():c()});n.ipcMain.handle("open-win",(i,s)=>{const o=new n.BrowserWindow({webPreferences:{preload:a,nodeIntegration:!0,contextIsolation:!1}});process.env.VITE_DEV_SERVER_URL?o.loadURL(`${p}#${s}`):o.loadFile(r,{hash:s})});
